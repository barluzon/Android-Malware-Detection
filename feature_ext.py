import staticAnalyzer
import sys
import os
from glob import glob

class feature_ext:
    def __init__(self):
        print("in init")
    def ext_features(self,file_path = sys.argv[1]):
        path = file_path
        result = os.listdir(path)
        print("result: ", result)
        with open(str(sys.argv[1]) + ".json", "a+") as r:
            r.write("[")
        r.close()
        last = len(result) - 1
        for i in result:
            ind = result.index(i)
            if not (i.endswith(".apk")):
                continue
            try:
                print('i is: ', i)
                print("path: ", path)
                print("ind: ", ind)
                print("last: ", last)

                staticAnalyzer.run(path + "/" + i, str(sys.argv[1]) + "/", ind, last, str(sys.argv[1]))
                # staticAnalyzer.run(path + "/" + i, str(sys.argv[1]), ind, last, str(sys.argv[1]))

            except Exception as e:
                print(e)
                print("file " + str(ind) + " failed")
                continue



        with open(str(sys.argv[1]) + ".json", "a+") as r:
            r.write("]")
        r.close()
