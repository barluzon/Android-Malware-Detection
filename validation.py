import pandas as pd
import numpy as np
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.metrics import confusion_matrix, classification_report


# Set pandas to show all columns when you print a dataframe
pd.set_option('display.max_columns', None)

dataset_path_csv = "out_vectorized_csv.csv"
print("Reading CSV File...")
df = pd.read_csv(dataset_path_csv)
print('df shape:', df.shape)

with open("select_features/best10000_features.txt", "r") as features_txt:
    new_list = features_txt.readlines()
features_list = [element.replace('\n', '') for element in new_list]


print(df.shape)
X = df[features_list].to_numpy()
y = np.stack(df['label'])
print("X shape: ", X.shape)
print("y shape: ", y.shape)

# Load the model
import pickle
clf = pickle.load(open('models/sec_svm_model_10000.pkl', 'rb'))
# We print our results
sns.set(rc={'figure.figsize': (15, 8)})
pred = clf.predict(X)
true_labels = y
predictions = []
for i in pred:
    predictions.append(i)
cf_matrix = confusion_matrix(true_labels, predictions)
clf_report = classification_report(true_labels, predictions, digits=5)
heatmap = sns.heatmap(cf_matrix, annot=True, cmap='Blues', fmt='g',
                      xticklabels=np.unique(true_labels),
                      yticklabels=np.unique(true_labels))

# The heatmap is cool but this is the most important result
print(clf_report)
